/*
* font dragr v1.5
* http://www.thecssninja.com/javascript/font-dragr
* Copyright (c) 2010 Ryan Seddon 
* released under the MIT License
*/var TCNDDF=TCNDDF||{};(function(){var e,t,n,r,i=document.createDocumentFragment(),s,o,u=window.localStorage||!1,a=window.applicationCache||window,f;TCNDDF.setup=function(){t=document.getElementById("fonts");e=document.getElementById("droptarget");n=document.getElementById("main");s=document.styleSheets[0];t.addEventListener("click",TCNDDF.handleFontChange,!1);if(u){n.addEventListener("keyup",function(){f=setTimeout("TCNDDF.writeContentEdits('mainContent')",1e3)},!1);n.addEventListener("keydown",function(){clearTimeout(f)},!1);TCNDDF.readContentEdits("mainContent")}e.addEventListener("dragenter",function(e){TCNDDF.preventActions(e)},!1);e.addEventListener("dragover",function(e){TCNDDF.preventActions(e)},!1);e.addEventListener("drop",TCNDDF.handleDrop,!1);a.addEventListener("updateready",TCNDDF.updateCache,!1);a.addEventListener("error",TCNDDF.errorCache,!1)};TCNDDF.handleDrop=function(e){var t=e.dataTransfer,n=t.files||!1,r=n.length,i=/^.*\.(ttf|otf|woff|eot|svg)$/i;TCNDDF.preventActions(e);for(var s=0;s<r;s++){var o=n[s],u=o.name,a,f;if(u.match(i)){f=Math.round(o.size/1024)+" KB";TCNDDF.processData(o,u,f)}else alert("Invalid file extension. Will only accept ttf, otf or woff font files")}};TCNDDF.processData=function(e,t,n){var r=new FileReader;name=t.replace(/\..+$/,"");name=name.replace(/\W+/g,"-");r.name=name;r.fullname=t;r.size=n;r.onloadend=function(e){TCNDDF.buildFontListItem(e)};r.readAsDataURL(e)};TCNDDF.buildFontListItem=function(e){r=[document.createElement("li"),document.createElement("span"),document.createElement("span"),document.createElement("em")];r[1].className="name";r[2].className="size";r[3].className="ss-icon delete";var u=e.target.fullname,a=e.target.name,f=e.target.size,l=e.target.result,c=l.split("base64");if(c[0].indexOf("application/octet-stream")==-1){c[0]="data:application/octet-stream;base64";l=c[0]+c[1]}o="@font-face{font-family: "+a+"; src:url("+l+");}";s.insertRule(o,0);r[3].appendChild(document.createTextNode("delete"));r[2].appendChild(document.createTextNode(f));r[1].appendChild(document.createTextNode(u));r[0].className="active";r[0].title=a;r[0].appendChild(r[1]);r[0].appendChild(r[2]);r[0].appendChild(r[3]);i.appendChild(r[0]);t.appendChild(i);TCNDDF.updateActiveFont(r[0]);n.style.fontFamily=a;$("#main").find(".textline").focus()};TCNDDF.handleFontChange=function(e){var t=e.target||window.event.srcElement;if(t.nodeName.toLowerCase()==="span"){t=t.parentNode;TCNDDF.updateActiveFont(t)}};TCNDDF.updateActiveFont=function(e){var r=e.title,i=t.getElementsByTagName("li");n.style.fontFamily=r;for(var s=0,o=i.length;s<o;s++)i[s].className="";e.className="active"};TCNDDF.readContentEdits=function(e){var t=u.getItem(e);!!t&&t!=="undefined"&&(n.innerHTML=t)};TCNDDF.writeContentEdits=function(e){var t=n.innerHTML;u.setItem(e,t)};TCNDDF.updateCache=function(){a.swapCache();console.log("Cache has been updated due to a change found in the manifest")};TCNDDF.errorCache=function(){console.log("You're either offline or something has gone horribly wrong.")};TCNDDF.preventActions=function(e){if(e.stopPropagation&&e.preventDefault){e.stopPropagation();e.preventDefault()}else{e.cancelBubble=!0;e.returnValue=!1}};window.addEventListener("load",TCNDDF.setup,!1);$(document).on("click","#fonts li .delete",function(e){e.preventDefault();e.stopPropagation();$(this).closest("li").hasClass("active")&&($(this).closest("li").next().length?TCNDDF.updateActiveFont($(this).closest("li").next()[0]):$(this).closest("li").prev().length&&TCNDDF.updateActiveFont($(this).closest("li").prev()[0]));$(this).closest("li").remove()})})();